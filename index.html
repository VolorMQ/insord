<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>Dansk Strukturtr√¶ner ‚Äî 6 –§–æ—Ä–º—É–ª</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #1e1e1e, #2f2f2f);
  color: #f0f0f0;
  display: flex;
  justify-content: center;
  padding: 20px;
}

.wrapper {
  display: flex;
  gap: 20px;
  max-width: 1200px;
  width: 100%;
}

.trainer {
  background: #222;
  padding: 20px;
  border-radius: 12px;
  flex: 2;
}

.rulesBox {
  background: #333;
  padding: 15px;
  border-radius: 12px;
  flex: 1;
  font-size: 14px;
  line-height: 1.6;
}

.option {
  background: #444;
  margin: 6px 0;
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.2s;
}

.option:hover { background: #555; }

.correct { background: #2e7d32 !important; }
.wrong { background: #c62828 !important; }

button {
  background: #ff5555;
  border: none;
  padding: 10px 20px;
  margin-top: 10px;
  border-radius: 8px;
  cursor: pointer;
  color: #fff;
  font-weight: bold;
}

#liveStats {
  margin-top: 15px;
  font-size: 14px;
  opacity: 0.9;
}
</style>
</head>
<body>

<div id="loader">
  <input type="file" id="jsonFile" accept=".json">
  <br>
  <button id="startBtn">Start</button>
</div>

<div class="wrapper" id="game" style="display:none;">

  <div class="trainer">
    <div id="question"></div>
    <div id="options"></div>
    <div id="progress"></div>
    <div id="liveStats"></div>
  </div>

  <div class="rulesBox">
    <h3>–ü—Ä–∞–≤–∏–ª–æ</h3>
    <div id="ruleText"></div>
  </div>

</div>

<script>
let levels = [];
let current = 0;
let stats = {
  correct: 0,
  wrong: 0,
  byFormula: {}
};

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

const rules = {
  1: `
üü¢ –§–æ—Ä–º—É–ª–∞ 1  
—Å–ª–æ–≤–∞ "er" –∏ "bliver" –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ. 

–ö–æ–≥–¥–∞ –≤ –¥–∞—Ç—Å–∫–æ–º —è–∑—ã–∫–µ –≤—Å—Ç—Ä–µ—Ç–∏—à—å —Å–ª–æ–≤–∞ "er" (—ç—Ç–æ –∫–∞–∫ –Ω–∞—à–µ "–µ—Å—Ç—å" –∏–ª–∏ "—è–≤–ª—è–µ—Ç—Å—è") –∏–ª–∏ "bliver" (—ç—Ç–æ –∑–Ω–∞—á–∏—Ç "—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è"), –¥–∞–ª—å—à–µ –∏–¥—ë—Ç —Å–ª–æ–≤–µ—á–∫–æ-–æ–ø–∏—Å–∞–Ω–∏–µ. –≠—Ç–æ —Å–ª–æ–≤–æ –≥–æ–≤–æ—Ä–∏—Ç, –∫–∞–∫–æ–π –∫—Ç–æ-—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–ª–∏ –∫–∞–∫ —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç.
`,
  2: `
üîµ –§–æ—Ä–º—É–ª–∞ 2  
–ø–æ—Å–ª–µ vil/kan/skal/m√• –∏–¥—ë—Ç –¥–µ–π—Å—Ç–≤–∏–µ. 

–ï—Å–ª–∏ –≤–∏–¥–∏—à—å —Å–ª–æ–≤–∞ vil, kan, skal, m√• ‚Äì –¥—É–º–∞–π, —á—Ç–æ —ç—Ç–æ –∫–∞–∫ –Ω–∞—à–∏ ¬´—Ö–æ—á—É¬ª, ¬´—É–º–µ—é¬ª, ¬´–¥–æ–ª–∂–µ–Ω¬ª, ¬´—Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è¬ª. –ü–æ—Å–ª–µ –Ω–∏—Ö –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å (—Ç–æ –µ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ).
`,
  3: `
üü£ –§–æ—Ä–º—É–ª–∞ 3  
—Å–ª–æ–≤–∞ "at", "fordi", "hvorfor" ‚Äì —Å—Ç–∞–≤–∏–º ikke –ø–µ—Ä–µ–¥ –≥–ª–∞–≥–æ–ª–æ–º. 

–°–ª–æ–≤–∞ "at" (–∫–∞–∫ ¬´—á—Ç–æ¬ª), "fordi" (¬´–ø–æ—Ç–æ–º—É —á—Ç–æ¬ª) –∏ "hvorfor" (¬´–ø–æ—á–µ–º—É¬ª) —á–∞—Å—Ç–æ —Å–æ–µ–¥–∏–Ω—è—é—Ç –¥–≤–µ –º—ã—Å–ª–∏. –ö–æ–≥–¥–∞ –∏—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º, –æ–±—ã—á–Ω–æ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º (–≥–ª–∞–≥–æ–ª–æ–º) —Å—Ç–∞–≤–∏–º ikke (—ç—Ç–æ ¬´–Ω–µ¬ª). –¢–∞–∫ –º—ã –¥–µ–ª–∞–µ–º –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ.
`,
  4: `
üü° –§–æ—Ä–º—É–ª–∞ 4  
"for/fordi" –∏ "men" ‚Äì ¬´–ø–æ—Ç–æ–º—É —á—Ç–æ¬ª –∏ ¬´–Ω–æ¬ª. 

–°–ª–æ–≤–∞ "for" –∏–ª–∏ "fordi" –≥–æ–≤–æ—Ä—è—Ç –Ω–∞–º ¬´–ø–æ—Ç–æ–º—É —á—Ç–æ¬ª, –∫–æ–≥–¥–∞ –æ–±—ä—è—Å–Ω—è–µ–º –ø—Ä–∏—á–∏–Ω—É. –ê —Å–ª–æ–≤–æ "men" –∑–Ω–∞—á–∏—Ç ¬´–Ω–æ¬ª, –∫–æ–≥–¥–∞ —Ö–æ—Ç–∏–º –ø–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω—Ç—Ä–∞—Å—Ç (–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é –º—ã—Å–ª—å).
`,
  5: `
üü† –§–æ—Ä–º—É–ª–∞ 5  
–ø–æ—Å–ª–µ til –∏–ª–∏ for —á–∞—Å—Ç–æ –∏–¥—ë—Ç "at" + –≥–ª–∞–≥–æ–ª. 

–°–ª–æ–≤–æ "til" –∏–ª–∏ "for" —á–∞—Å—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –¥–∞–ª—å—à–µ –±—É–¥–µ—Ç ¬´to do something¬ª. –¢–æ –µ—Å—Ç—å –º—ã –¥–æ–±–∞–≤–ª—è–µ–º "at" –∏ –¥–µ–π—Å—Ç–≤–∏–µ. –≠—Ç–æ –∫–∞–∫ ¬´—á—Ç–æ–±—ã —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞—Ç—å¬ª.
`,
  6: `
üü§ –§–æ—Ä–º—É–ª–∞ 6  
–≤ –¥–ª–∏–Ω–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è—Ö –≥–ª–∞–≥–æ–ª —Å—Ç–∞–≤–∏–º –≤ –∫–æ–Ω–µ—Ü. 

–ï—Å–ª–∏ –º—ã —Å—Ç—Ä–æ–∏–º —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å "—á—Ç–æ" –∏–ª–∏ "–ø–æ—Ç–æ–º—É —á—Ç–æ"), —Ç–æ –≤ —á–∞—Å—Ç–∏ –ø–æ—Å–ª–µ —ç—Ç–∏—Ö —Å–ª–æ–≤ –≥–ª–∞–≤–Ω—ã–π –≥–ª–∞–≥–æ–ª –æ–±—ã—á–Ω–æ –∏–¥—ë—Ç –≤ —Å–∞–º—ã–π –∫–æ–Ω–µ—Ü.
`
};

const JSON_URL = "1.json"; // —Å—Å—ã–ª–∫–∞ –Ω–∞ JSON —Å —Å–µ—Ä–≤–µ—Ä–∞

function loadJSONFromServer() {
  fetch(JSON_URL)
    .then(res => {
      if (!res.ok) throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å JSON: " + res.status);
      return res.json();
    })
    .then(data => {
      initGame(data);
    })
    .catch(err => {
      console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å —Å–µ—Ä–≤–µ—Ä–∞:", err.message);
      document.getElementById("loader").style.display = "block";
      alert("–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å. –ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON –≤—Ä—É—á–Ω—É—é.");
    });
}

document.getElementById("startBtn").onclick = () => {
  const fileInput = document.getElementById("jsonFile");
  if (!fileInput.files[0]) {
    alert("–í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª");
    return;
  }

  const reader = new FileReader();
  reader.onload = e => {
    const data = JSON.parse(e.target.result);
    initGame(data);
  };
  reader.readAsText(fileInput.files[0]);
};

function initGame(data) {
  levels = shuffle(data);
  current = 0;
  stats = { correct: 0, wrong: 0, byFormula: {} };

  document.getElementById("loader").style.display = "none";
  document.getElementById("game").style.display = "flex";

  showQuestion();
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —Å—Ä–∞–∑—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener("load", () => {
  loadJSONFromServer();
});


function showQuestion() {
  const q = levels[current];

  document.getElementById("question").innerHTML =
    "<h2>" + q.question + "</h2>";

  document.getElementById("ruleText").innerHTML =
    rules[q.formula] || "–ù–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —ç—Ç–æ–π —Ñ–æ—Ä–º—É–ª—ã";

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";

  shuffle([...q.options]).forEach(opt => {
    const div = document.createElement("div");
    div.className = "option";
    div.innerText = opt;
    div.onclick = () => checkAnswer(opt, div, q);
    optionsDiv.appendChild(div);
  });

  updateProgress();
  updateLiveStats(q.formula);
}

function checkAnswer(selected, btn, q) {
  const correct = q.answer;
  const optionsDiv = document.getElementById("options");

  if (!stats.byFormula[q.formula]) {
    stats.byFormula[q.formula] = { correct: 0, wrong: 0 };
  }

  if (selected === correct) {
    btn.classList.add("correct");
    stats.correct++;
    stats.byFormula[q.formula].correct++;
  } else {
    btn.classList.add("wrong");
    stats.wrong++;
    stats.byFormula[q.formula].wrong++;

    Array.from(optionsDiv.children).forEach(c => {
      if (c.innerText === correct) {
        c.classList.add("correct");
      }
    });
  }

  updateLiveStats(q.formula);

  setTimeout(() => {
    current++;
    if (current < levels.length) {
      showQuestion();
    } else {
      document.querySelector(".trainer").innerHTML =
        "<h2>–ì–æ—Ç–æ–≤–æ üéâ</h2><p>–ü—Ä–∞–≤–∏–ª—å–Ω–æ: " + stats.correct +
        " | –û—à–∏–±–∫–∏: " + stats.wrong + "</p>" +
        "<button onclick='location.reload()'>–°–Ω–æ–≤–∞</button>";
      document.getElementById("ruleText").innerHTML = "";
    }
  }, 900);
}

function updateProgress() {
  document.getElementById("progress").innerText =
    `–í–æ–ø—Ä–æ—Å ${current + 1} –∏–∑ ${levels.length}`;
}

function updateLiveStats(currentFormula) {
  const total = stats.correct + stats.wrong;
  const percent = total === 0 ? 0 :
    Math.round((stats.correct / total) * 100);

  const formulaData = stats.byFormula[currentFormula] || 
    { correct: 0, wrong: 0 };

  document.getElementById("liveStats").innerHTML = `
    <hr>
    ‚úî –ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: ${stats.correct} |
    ‚ùå –û—à–∏–±–æ–∫: ${stats.wrong} |
    üìä ${percent}% <br>
    –§–æ—Ä–º—É–ª–∞ ${currentFormula}: 
    ‚úî ${formulaData.correct} | 
    ‚ùå ${formulaData.wrong}
  `;
}
</script>

</body>
</html>
